<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DartScore - Track Your Game</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='48' fill='%23111827' stroke='%2300e5ff' stroke-width='3'/><circle cx='50' cy='50' r='36' fill='none' stroke='%2300e5ff' stroke-width='2' opacity='0.5'/><circle cx='50' cy='50' r='24' fill='none' stroke='%2300e5ff' stroke-width='2' opacity='0.4'/><circle cx='50' cy='50' r='12' fill='%2300e5ff' opacity='0.3'/><circle cx='50' cy='50' r='5' fill='%2300e5ff'/></svg>">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- ==================== SETUP SCREEN ==================== -->
<div id="setup-screen" class="screen active">
    <div class="setup-container">
        <div class="logo-area">
            <div class="dartboard-icon">
                <svg viewBox="0 0 120 120" width="72" height="72">
                    <circle cx="60" cy="60" r="56" fill="none" stroke="var(--accent)" stroke-width="2" opacity="0.3"/>
                    <circle cx="60" cy="60" r="44" fill="none" stroke="var(--accent)" stroke-width="1.5" opacity="0.25"/>
                    <circle cx="60" cy="60" r="32" fill="none" stroke="var(--accent)" stroke-width="1.5" opacity="0.3"/>
                    <circle cx="60" cy="60" r="20" fill="none" stroke="var(--accent)" stroke-width="1.5" opacity="0.35"/>
                    <circle cx="60" cy="60" r="8" fill="var(--accent)" opacity="0.6"/>
                    <circle cx="60" cy="60" r="3" fill="var(--accent)"/>
                    <line x1="60" y1="4" x2="60" y2="116" stroke="var(--accent)" stroke-width="0.5" opacity="0.15"/>
                    <line x1="4" y1="60" x2="116" y2="60" stroke="var(--accent)" stroke-width="0.5" opacity="0.15"/>
                </svg>
            </div>
            <h1 class="app-title">DART<span>SCORE</span></h1>
            <p class="app-subtitle">Precision Scoring System</p>
        </div>

        <div class="setup-card">
            <h2>Game Setup</h2>

            <!-- ---- SIMPLE SETTINGS ---- -->
            <div class="game-mode-section">
                <label class="section-label">Starting Score</label>
                <div class="mode-buttons">
                    <button class="mode-btn active" data-score="301">301</button>
                    <button class="mode-btn" data-score="501">501</button>
                    <button class="mode-btn" data-score="701">701</button>
                    <button class="mode-btn" data-score="custom" id="custom-score-btn">Custom</button>
                </div>
                <div class="custom-score-row" id="custom-score-row" style="display:none;">
                    <input type="number" id="custom-score-input" class="custom-score-input"
                           placeholder="Enter starting score..." min="2" max="99999" autocomplete="off">
                </div>
            </div>

            <div class="players-section">
                <label class="section-label">Players</label>
                <div id="player-list" class="player-list"></div>
                <button id="add-player-btn" class="add-player-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Add Player
                </button>
            </div>

            <!-- ---- ADVANCED SETTINGS TOGGLE ---- -->
            <div class="advanced-toggle-wrapper">
                <button id="toggle-advanced-btn" class="toggle-advanced-btn">
                    <svg class="toggle-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    <span>Advanced Settings</span>
                    <svg class="toggle-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
                </button>
            </div>

            <!-- ---- ADVANCED SETTINGS (collapsed) ---- -->
            <div id="advanced-settings" class="advanced-settings">
                <div class="checkout-section">
                    <label class="section-label">Checkout Rule</label>
                    <div class="mode-buttons checkout-modes">
                        <button class="checkout-btn active" data-checkout="zero-or-less">Zero or Less</button>
                        <button class="checkout-btn" data-checkout="straight">Straight Out</button>
                        <button class="checkout-btn" data-checkout="double">Double Out</button>
                    </div>
                    <p class="checkout-hint" id="checkout-hint">Score reaches zero or below to win. No bust possible.</p>
                </div>
                <div class="handicap-section">
                    <label class="section-label">Player Handicaps</label>
                    <p class="handicap-hint">Adjust each player's starting score relative to the base</p>
                    <div id="handicap-list" class="handicap-list"></div>
                    <button id="clear-handicaps-btn" class="clear-handicaps-btn">Reset All Handicaps</button>
                </div>
            </div>

            <button id="start-game-btn" class="start-btn">
                <span>Start Game</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </button>
        </div>
    </div>
</div>

<!-- ==================== GAME SCREEN ==================== -->
<div id="game-screen" class="screen">
    <header class="game-header">
        <button id="back-btn" class="icon-btn" title="Back to setup">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <div class="header-info">
            <span class="game-mode-label" id="game-mode-label">501</span>
            <span class="checkout-rule-label" id="checkout-rule-label">Zero or Less</span>
            <span class="round-label">Round <span id="round-num">1</span></span>
        </div>
        <div class="header-actions">
            <button id="undo-btn" class="icon-btn" title="Undo last turn">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M3 10h10a5 5 0 0 1 0 10H9"/><path d="M3 10l4-4M3 10l4 4"/></svg>
            </button>
            <button id="see-results-header-btn" class="icon-btn see-results-icon" title="See Results" style="display:none;">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
            </button>
        </div>
    </header>

    <div id="players-container" class="players-container"></div>

    <div class="input-section">
        <div class="score-display">
            <div class="current-player-indicator">
                <div class="indicator-avatar" id="current-avatar"></div>
                <span id="current-player-name">Player 1</span>
            </div>
            <div class="score-input-display" id="score-display">0</div>
        </div>

        <div class="dart-tracker">
            <span class="dart-label">Darts:</span>
            <div class="dart-dots">
                <span class="dart-dot" id="dart-1"></span>
                <span class="dart-dot" id="dart-2"></span>
                <span class="dart-dot" id="dart-3"></span>
            </div>
            <div class="dart-scores" id="dart-scores"></div>
            <button id="undo-dart-btn" class="dart-action-btn" title="Undo last dart" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M3 10h10a5 5 0 0 1 0 10H9"/><path d="M3 10l4-4M3 10l4 4"/></svg>
            </button>
            <button id="clear-round-btn" class="dart-action-btn clear-btn" title="Clear all darts" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>

        <div class="dartboard-container" id="dartboard-container">
            <canvas id="dartboard-canvas"></canvas>
            <div class="magnifier" id="magnifier" style="display:none;">
                <canvas id="magnifier-canvas" width="260" height="260"></canvas>
                <div class="magnifier-label" id="magnifier-label"></div>
            </div>
        </div>

        <button id="miss-btn" class="miss-board-btn">MISS</button>
        <button id="submit-turn-btn" class="submit-btn" disabled>Submit Turn</button>
    </div>
</div>

<!-- ==================== WINNER BANNER ==================== -->
<div id="winner-banner" class="winner-banner" style="display:none;">
    <div class="winner-banner-inner">
        <div class="banner-confetti" id="banner-confetti"></div>
        <div class="banner-trophy">üèÜ</div>
        <span class="banner-avatar" id="banner-winner-avatar"></span>
        <span class="banner-text"><span id="banner-winner-name"></span> wins!</span>
        <div class="banner-actions">
            <button id="banner-dismiss-btn" class="banner-btn banner-continue">Continue Playing</button>
            <button id="banner-see-results-btn" class="banner-btn banner-results">See Results</button>
        </div>
    </div>
</div>

<!-- ==================== FINISH / SUMMARY SCREEN ==================== -->
<div id="finish-screen" class="screen">
    <div class="finish-container">
        <div class="finish-header-area">
            <h2 class="finish-title">Game Summary</h2>
            <div class="finish-meta" id="finish-meta"></div>
        </div>
        <div class="finish-leaderboard" id="finish-leaderboard"></div>
        <div class="finish-graph-section">
            <h3 class="finish-section-title">Score Progression</h3>
            <div class="chart-wrapper">
                <canvas id="score-chart"></canvas>
            </div>
        </div>
        <div class="finish-hotspots-section" id="finish-hotspots-section">
            <h3 class="finish-section-title">Dart Hotspots</h3>
            <div class="hotspot-carousel" id="hotspot-carousel"></div>
            <div class="hotspot-dots" id="hotspot-dots"></div>
        </div>
        <div class="finish-detailed-stats" id="finish-detailed-stats"></div>
        <div class="finish-game-log-section" id="finish-game-log-section">
            <h3 class="finish-section-title">Game Log</h3>
            <div class="game-log" id="game-log"></div>
        </div>
        <div class="finish-actions">
            <button id="finish-share-btn" class="action-btn share-action">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="margin-right:6px;"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                Copy Results
            </button>
            <button id="finish-rematch-btn" class="action-btn primary-action">Rematch</button>
            <button id="finish-new-game-btn" class="action-btn secondary-action">New Game</button>
        </div>
    </div>
</div>

<!-- ==================== RULES MODAL ==================== -->
<div id="rules-modal" class="modal-overlay">
    <div class="modal-content rules-modal-content">
        <button class="modal-close" id="close-rules">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
        <h2>How to Play Darts</h2>
        <div class="rules-body">
            <div class="rule-section">
                <h3>üéØ Objective</h3>
                <p>Reduce your score from the starting number. The win condition depends on the checkout rule.</p>
            </div>
            <div class="rule-section">
                <h3>üé™ The Dartboard</h3>
                <p>Numbers <strong>1‚Äì20</strong> with single, double, and triple areas. Center: <strong>Bullseye (50)</strong> and <strong>Outer Bull (25)</strong>.</p>
            </div>
            <div class="rule-section">
                <h3>üì± How to Score</h3>
                <p><strong>Press and hold</strong> on the dartboard to see a magnified view. <strong>Drag</strong> to aim precisely, then <strong>release</strong> to register your dart.</p>
            </div>
            <div class="rule-section">
                <h3>üìã Gameplay</h3>
                <ul>
                    <li>Each player throws <strong>3 darts</strong> per turn</li>
                    <li><strong>Single:</strong> Face value (1‚Äì20)</li>
                    <li><strong>Double:</strong> 2√ó the number (outer ring)</li>
                    <li><strong>Triple:</strong> 3√ó the number (inner ring)</li>
                    <li><strong>Bullseye:</strong> 25 (outer) or 50 (double bull)</li>
                </ul>
            </div>
            <div class="rule-section">
                <h3>üèÅ Checkout Rules</h3>
                <p><strong>Zero or Less:</strong> First player whose score reaches <strong>zero or below</strong> wins.</p>
                <p><strong>Straight Out:</strong> Reach <strong>exactly zero</strong> to win.</p>
                <p><strong>Double Out:</strong> Finish on a <strong>double</strong> at exactly zero.</p>
            </div>
            <div class="rule-section">
                <h3>üí• Bust</h3>
                <p>In Straight/Double Out, going below zero (or to 1 in Double Out) voids your turn.</p>
                <p>Zero or Less has <strong>no bust</strong>.</p>
            </div>
            <div class="rule-section">
                <h3>‚öñÔ∏è Handicaps</h3>
                <p>In Advanced Settings, give players different starting scores to level the playing field.</p>
            </div>
        </div>
    </div>
</div>

<!-- ==================== AVATAR PICKER MODAL ==================== -->
<div id="avatar-modal" class="modal-overlay">
    <div class="modal-content avatar-modal-content">
        <button class="modal-close" id="close-avatar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
        <h2>Choose Avatar</h2>
        <div class="avatar-grid" id="avatar-grid"></div>
    </div>
</div>

<!-- ==================== HELP BUTTON ==================== -->
<button id="help-btn" class="help-fab" title="Rules of Darts">
    <span>?</span>
</button>

<script type="module" src="js/app.js"></script>
</body>
</html>
